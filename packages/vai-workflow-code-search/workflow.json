{
  "name": "code-search",
  "description": "Index, search, explain, and find duplicate code across any codebase using Voyage AI's code-optimized embedding models and MongoDB Atlas Vector Search.",
  "version": "1.0.0",
  "inputs": {
    "source": {
      "type": "string",
      "required": true,
      "description": "Local directory path to index"
    },
    "query": {
      "type": "string",
      "required": true,
      "description": "Natural language search query or code snippet"
    },
    "collection": {
      "type": "string",
      "description": "MongoDB collection name (auto-derived from project if omitted)"
    },
    "db": {
      "type": "string",
      "description": "MongoDB database name",
      "default": "vai_code_search"
    },
    "limit": {
      "type": "number",
      "default": 10
    }
  },
  "defaults": {},
  "steps": [
    {
      "id": "index_codebase",
      "tool": "code_index",
      "name": "Index Codebase",
      "description": "Scan, chunk, and embed all files in the source directory into MongoDB Atlas Vector Search.",
      "inputs": {
        "path": "{{ inputs.source }}",
        "db": "{{ inputs.db }}",
        "collection": "{{ inputs.collection }}",
        "model": "voyage-code-3",
        "contentType": "code",
        "maxFiles": 5000,
        "maxFileSize": 100000,
        "chunkSize": 512,
        "chunkOverlap": 50,
        "batchSize": 20
      }
    },
    {
      "id": "search",
      "tool": "code_search",
      "name": "Semantic Code Search",
      "description": "Search indexed code using natural language queries. Finds implementations by intent, not just keywords.",
      "dependsOn": ["index_codebase"],
      "inputs": {
        "query": "{{ inputs.query }}",
        "db": "{{ inputs.db }}",
        "collection": "{{ index_codebase.output.collection }}",
        "limit": "{{ inputs.limit }}",
        "rerank": true,
        "rerankModel": "rerank-2.5"
      }
    },
    {
      "id": "explain",
      "tool": "code_query",
      "name": "Explain Code (RAG)",
      "description": "Ask questions about the codebase and get AI-generated explanations grounded in the actual source code.",
      "dependsOn": ["index_codebase"],
      "inputs": {
        "query": "{{ inputs.query }}",
        "db": "{{ inputs.db }}",
        "collection": "{{ index_codebase.output.collection }}",
        "limit": "{{ inputs.limit }}",
        "rerank": true
      }
    },
    {
      "id": "find_similar",
      "tool": "code_find_similar",
      "name": "Find Similar Code",
      "description": "Detect duplicate or semantically similar code across the indexed codebase.",
      "dependsOn": ["index_codebase"],
      "inputs": {
        "code": "{{ inputs.query }}",
        "db": "{{ inputs.db }}",
        "collection": "{{ index_codebase.output.collection }}",
        "threshold": 0.85,
        "limit": "{{ inputs.limit }}"
      }
    }
  ],
  "output": {
    "search_results": "{{ search.output.results }}",
    "explanation": "{{ explain.output.answer }}",
    "similar_code": "{{ find_similar.output.matches }}"
  }
}
